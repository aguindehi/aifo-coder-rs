.TH AIFO-CODER 1 "2025-08-23" "aifo-coder" "User Commands"
.SH NAME
aifo-coder \- secure Docker-based launcher for coding assistant agents
.SH SYNOPSIS
.B aifo-coder
.RB [ OPTIONS ]
.I COMMAND
.RI [ " -- " "AGENT-OPTIONS" ]
.P
.B aifo-coder
.RB [ \-h | \-\-help ]
.P
.B aifo-coder
.RB [ \-V | \-\-version ]
.SH DESCRIPTION
.B aifo-coder
is a small Rust CLI that launches developer "agent" tools inside Docker
containers with safe defaults. It assembles a
.B docker run
command with:
.IP \[bu] 2
TTY detection for interactive sessions.
.IP \[bu]
UID:GID mapping to the invoking user.
.IP \[bu]
Conservative environment pass\-through.
.IP \[bu]
Minimal host mounts.
.IP \[bu]
An AppArmor profile on hosts that support it.
.P
To prevent concurrent runs that might contend for the same workspace,
.B aifo-coder
creates a lock file at a candidate location (see
.BR FILES ).
.P
Different agents are selected via the positional
.I COMMAND
subcommand. Additional options after
.B --
.RI ( AGENT-OPTIONS )
are passed through unchanged to the agent process inside the container.
.SH AGENTS
The set of available agents is build\-dependent. Common agents include:
.TP
.B codex
Run the OpenAI Codex\-based CLI.
.TP
.B crush
Run the Charmbracelet Crush TUI.
.P
Consult the installed documentation for agent\-specific details.
.SH OPTIONS
.TP
.BR \-\-image =IMAGE
Override the Docker image reference used for the selected agent. If unset,
the image is derived from
.BR AIFO_CODER_IMAGE ,
.BR AIFO_CODER_IMAGE_PREFIX " and " AIFO_CODER_IMAGE_TAG
(see ENVIRONMENT).
.TP
.BR \-\-toolchain " " KIND
Attach language toolchains and inject PATH shims (repeatable). Supported kinds:
.B rust ,
.B node ,
.B typescript
(alias of node),
.B python ,
.B c\-cpp ,
.B go .
.TP
.BR \-\-toolchain\-image " " KIND=IMAGE
Override image per toolchain kind (repeatable).
.TP
.BR \-\-no\-toolchain\-cache
Disable named cache volumes for toolchain sidecars.
.TP
.BR \-\-toolchain\-unix\-socket
On Linux, use a unix:/// socket transport for the tool\-exec proxy instead of TCP.
The socket directory is bind\-mounted into the agent at
.BR /run/aifo .
.TP
.BR \-h ", " \-\-help
Print help and exit.
.TP
.BR \-V ", " \-\-version
Print version information and exit.
.SH ENVIRONMENT
.TP
.B AIFO_CODER_IMAGE
If set to a non\-empty string, use this Docker image reference for all agents,
overriding per\-agent defaults and \-\-image.
.TP
.B AIFO_CODER_IMAGE_PREFIX
Prefix used to construct default image references when
.BR AIFO_CODER_IMAGE
is not set. Defaults to
.BR aifo\-coder .
.TP
.B AIFO_CODER_IMAGE_TAG
Tag used to construct default image references when
.BR AIFO_CODER_IMAGE
is not set. Defaults to
.BR latest .
.TP
.B AIFO_CODER_REGISTRY_PREFIX
Override the Docker registry prefix for image pulls. If unset, the launcher tests connectivity to
https://repository.migros.net
and uses
.B repository.migros.net/
when reachable; otherwise no registry prefix is used and Docker Hub is assumed. Set to an empty string to force Docker Hub.
.TP
.B AIFO_CODER_APPARMOR_PROFILE
If set to a non\-empty string on Linux hosts whose Docker daemon reports
AppArmor support, this value is applied as the container's AppArmor profile
(via
.BR \-\-security\-opt " " apparmor=PROFILE ).
When unset, the launcher chooses a sensible default (a custom profile on
native Linux; docker\-default on macOS/Windows Docker\-in\-VM).
.TP
.B XDG_RUNTIME_DIR
Considered as a higher\-priority location for the lock file. If set to a
non\-empty directory, the lock may be created at
.BR $XDG_RUNTIME_DIR/aifo\-coder.lock .
.TP
.B HOME
Used for default paths and may influence host mounts inside the container.
.TP
.B GNUPGHOME
May be passed through to the container environment to enable GPG operations,
depending on the agent and launcher defaults.
.TP
.B AIFO_TOOLEEXEC_URL
Internal: URL the agent shims contact to execute tools via sidecars
(e.g., http://host.docker.internal:PORT/exec). Set automatically when
\-\-toolchain is used as a global option.
.TP
.B AIFO_TOOLEEXEC_TOKEN
Internal: bearer token used by shims to authenticate to the proxy. Set
automatically when \-\-toolchain is used.
.TP
.B AIFO_SESSION_NETWORK
Internal: ephemeral Docker network name that the agent joins to communicate
with toolchain sidecars (created automatically per session).
.TP
.B AIFO_TOOLEEXEC_TIMEOUT_SECS
Per-request timeout in seconds for the toolexec proxy (default: 60). Increase on slow CI,
lower to fail fast on unresponsive tool invocations.
.TP
.B AIFO_TOOLEEXEC_USE_UNIX
On Linux, when set to
.BR 1 ,
the launcher starts the toolexec proxy bound to a unix domain socket and mounts
the socket directory into the agent. The shim uses
.BR unix:///run/aifo/toolexec.sock
to connect.
.TP
.B AIFO_TOOLEEXEC_UNIX_DIR
Host directory containing the proxy's unix socket (set automatically when unix
transport is enabled). It is bind\-mounted into the agent at
.BR /run/aifo .
.TP
.B AIFO_SHIM_DIR
Path on the host to a directory containing the shim binary and symlinks to be
bind-mounted into the agent at
.BR /opt/aifo/bin .
This allows overriding the embedded shims in the agent image for development
or debugging. When unset, the embedded shims shipped in the image are used.
.SH SECURITY
On Linux hosts with AppArmor support, the launcher attempts to run agents
under a constrained AppArmor profile to reduce kernel attack surface and
limit syscalls and capabilities. An AppArmor profile may be installed
system\-wide by your distribution or administrator. When AppArmor
is unavailable (e.g., macOS Docker\-in\-VM) the launcher falls back to the
Docker default profile.
.SH FILES
.TP
.B ~/.aifo\-coder.lock
Per\-user lock file candidate.
.TP
.B $XDG_RUNTIME_DIR/aifo\-coder.lock
Per\-session lock file candidate when
.B XDG_RUNTIME_DIR
is set.
.TP
.B /tmp/aifo\-coder.lock
Fallback lock file candidate.
.TP
.B /etc/apparmor.d/aifo\-coder
System AppArmor profile (if installed) used to constrain containerized agents.
.SH EXIT STATUS
The launcher propagates the exit status of the agent process running inside
the container. A non\-zero exit code indicates failure reported by the agent
or the container runtime.
.SH EXAMPLES
.TP
Run the Codex agent with default image:
.P
.nf
aifo\-coder codex \-\- \-\-help
.fi
.TP
Run the Crush agent with a custom image:
.P
.nf
aifo\-coder \-\-image aifo\-coder\-crush:nightly crush
.fi
.SH TOOLCHAIN
The toolchain subcommand launches a sidecar container for a language toolchain
and executes the specified command within it.
.TP
.B aifo-coder toolchain
.I kind
\-\-
.I args...
.P
Supported kinds:
.B rust ,
.B node ,
.B typescript
(alias of node),
.B python ,
.B c\-cpp ,
.B go .
.P
Options:
.TP
.BR \-\-toolchain\-image " " =IMAGE
Override the image reference used for the toolchain sidecar.
.TP
.BR \-\-no\-toolchain\-cache
Disable named cache volumes for this run.
.P
Examples:
.P
.nf
aifo\-coder toolchain rust \-\- cargo \-\-version
aifo\-coder toolchain node \-\- npx \-\-version
aifo\-coder toolchain python \-\- python \-m pip \-\-version
.fi
.P
When provided as a global option, \-\-toolchain attaches sidecars and injects PATH
shims for the selected kinds so that commands like
.B cargo ,
.B npx ,
.B python ,
.B gcc ,
or
.B go
invoked inside the agent are transparently executed via the sidecars.
.P
.SH TOOLCHAIN CACHE
Purge all named Docker volumes used for toolchain caches. This removes caches for
Rust (cargo registry/git), Node (npm), Python (pip), C/C++ (ccache), and Go.
.P
.nf
aifo\-coder toolchain\-cache\-clear
.fi
.P
Embedded shims:
Agent images embed a compiled
.B aifo-shim
at
.B /opt/aifo/bin
with symlinks for common tools (cargo, npm/npx/tsc, python/pip, gcc/clang, go).
The PATH is prepended so these tools are available in the agent. For development
or debugging you can override embedded shims by bind\-mounting a host directory
via
.BR AIFO_SHIM_DIR
to
.BR /opt/aifo/bin .
.P
Linux connectivity note:
When toolchains are attached, the agent is launched with a host\-gateway entry so
.B host.docker.internal
resolves to the host proxy. If connectivity issues arise on Linux, ensure the launcher
adds
.BR \-\-add\-host=host.docker.internal:host\-gateway
(which it does automatically when toolchains are enabled).
.SH SEE ALSO
.BR docker (1),
.BR apparmor (7),
.BR sh (1)
.SH AUTHORS
Amir Guindehi <amir.guindehi@mgb.ch> and contributors.
.SH COPYRIGHT
Copyright (c) the aifo\-coder authors.
License: Apache License 2.0. See
.BR /usr/share/licenses/aifo\-coder/LICENSE
or https://www.apache.org/licenses/LICENSE-2.0.
